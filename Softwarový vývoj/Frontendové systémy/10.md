# 10. Identita uživatele

## Autentizace vs Autorizace

**Autentizace vs Autorizace**

**Autentizace (Authentication):**

* **Ověření identity** - kdo je uživatel
* **Metody:** heslo, 2FA, biometrie, SSO
* **Výsledek:** potvrzení totožnosti

**Autorizace (Authorization):**

* **Řízení přístupu** - co může uživatel dělat
* **Metody:** role-based (RBAC), attribute-based (ABAC), ACL
* **Výsledek:** povolení/zamítnutí akce

**Proces:**

1. Autentizace → 2. Autorizace → 3. Přístup k prostředku

**Technologie:**

* **JWT tokens** - obsahují identity claims
* **OAuth 2.0** - autorizační framework
* **OpenID Connect** - identitní vrstva nad OAuth
* **LDAP/Active Directory** - správa uživatelů

**Příklad:**

Login (autentizace) → Kontrola oprávnění k editaci článku (autorizace)

## JWT tokeny

**JSON Web Tokens (JWT)**

**Struktura JWT:**

1. **Header** - typ tokenu a algoritmus podpisu
2. **Payload** - claims (tvrzení o uživateli)
3. **Signature** - digitální podpis pro ověření integrity

**Typy claims:**

* **Registered** - standardní (iss, exp, sub, aud)
* **Public** - veřejně definované
* **Private** - custom aplikační data

**Výhody:**

* Self-contained - obsahuje všechny potřebné informace
* Stateless - server nepotřebuje ukládat session
* Škálovatelnost
* Cross-domain použití

**Nevýhody:**

* Velikost tokenu
* Obtížné revoking (zneplatnění)
* Bezpečnostní rizika při špatném použití

**Použití:**

Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

**Knihovny:** jose (Node.js), PyJWT (Python), jjwt (Java)

## Session management

**Správa sessions (relací)**

**Tradiční session:**

* **Server-side storage** - data uložena na serveru
* **Session ID** - identifikátor v cookie
* **Stateful** - server si pamatuje stav

**Implementace:**

* **In-memory** - rychlé, ale neškáluje
* **Database** - perzistentní, škálovatelné
* **Redis/Memcached** - rychlé, distribuované

**Bezpečnost sessions:**

* **Secure cookie flag** - pouze HTTPS
* **HttpOnly flag** - ochrana před XSS
* **SameSite** - ochrana před CSRF
* **Session timeout** - automatické vypršení
* **Session regeneration** - nové ID po přihlášení

**Výhody vs JWT:**

* Snadné revoking
* Menší velikost cookie
* Server má plnou kontrolu

**Nevýhody vs JWT:**

* Stateful - složitější škálování
* Závislost na server storage
* Session fixation útoky

## OAuth 2.0 a OpenID Connect

**OAuth 2.0 Framework**

**Účel:**

Autorizační framework pro delegování přístupu k prostředkům bez sdílení credentials

**Role v OAuth:**

* **Resource Owner** - vlastník prostředku (uživatel)
* **Client** - aplikace žádající o přístup
* **Authorization Server** - vydává tokeny
* **Resource Server** - chrání prostředky

**Grant types:**

* **Authorization Code** - nejbezpečnější pro web apps
* **Client Credentials** - server-to-server
* **PKCE** - pro mobile/SPA aplikace

**OpenID Connect (OIDC):**

* Identitní vrstva nad OAuth 2.0
* **ID Token** - JWT s informacemi o uživateli
* **UserInfo endpoint** - dodatečné user claims

**Použití:**

\"Login with Google\", \"Login with Facebook\" - využívají OIDC

**Výhody:**

* Standardizované řešení
* Bezpečné delegování
* Single Sign-On možnosti

## Single Sign-On (SSO)

**Single Sign-On (SSO)**

**Definice:**

Jeden login pro přístup k více aplikacím nebo systémům

**Protokoly:**

* **SAML 2.0** - XML-based, enterprise řešení
* **OpenID Connect** - JSON/REST-based, moderní
* **CAS** - Central Authentication Service
* **Kerberos** - network authentication protocol

**Typy SSO:**

* **Enterprise SSO** - Active Directory, LDAP
* **Web SSO** - cross-domain web aplikace
* **Social SSO** - Google, Facebook, Microsoft

**SAML flow:**

1. Uživatel → App → 2. Redirect na IdP → 3. Autentizace → 4. SAML assertion → 5. Přístup

**Výhody:**

* Lepší user experience
* Centralizovaná správa uživatelů
* Snížení password fatigue
* Compliance a audit

**Nevýhody:**

* Single point of failure
* Složitější implementace
* Vendor lock-in riziko

**Providers:** Auth0, Okta, Azure AD, Google Workspace

## Správa identity ve frontendové aplikaci

**Frontend Identity Management**

**Ukládání tokenů:**

* **LocalStorage** - persistentní, ale XSS vulnerable
* **SessionStorage** - session-based, stále XSS risk
* **Memory** - nejbezpečnější, ale ztráta při refresh
* **HttpOnly cookies** - nejbezpečnější pro session

**Token management:**

* **Access token** - krátká životnost (15 min)
* **Refresh token** - delší životnost, pro obnovení
* **Automatic refresh** - background token renewal
* **Token expiration handling** - logout při expiraci

**React/Vue patterns:**

* **Context/Store** - globální auth state
* **Protected routes** - Route guards
* **Axios/Fetch interceptors** - automatické přidání tokenů
* **Auth hooks/composables** - reusable auth logic

**Bezpečnostní opatření:**

* HTTPS pouze
* Secure token storage
* CSRF protection
* XSS prevention
* Content Security Policy

**Knihovny:** Auth0 SPA SDK, Firebase Auth, AWS Amplify

## Komunikace se serverem pod identitou

**Autentizovaná komunikace se serverem**

**HTTP Headers pro autentizaci:**

* **Authorization: Bearer {token}** - JWT token
* **Authorization: Basic {credentials}** - base64 encoded
* **X-API-Key: {key}** - API klíč
* **Cookie** - session identifier

**Implementace v JavaScriptu:**

fetch('/api/data', {

headers: { 'Authorization': 'Bearer ' + token }

})

**Axios interceptor:**

axios.interceptors.request.use(config => {

config.headers.Authorization = `Bearer ${getToken()}`

return config

})

**Error handling:**

* **401 Unauthorized** - token neplatný/expirovaný
* **403 Forbidden** - nedostatečná oprávnění
* **Token refresh** - automatické obnovení
* **Logout** - při kritických chybách

**Bezpečnostní aspekty:**

* Token validation na serveru
* Rate limiting per user
* Audit logging
* Secure token transmission

## Multi-factor Authentication (MFA)

**Multi-factor Authentication (MFA)**

**Faktory autentizace:**

* **Something you know** - heslo, PIN
* **Something you have** - telefon, token
* **Something you are** - biometrie

**Implementace MFA:**

* **SMS kódy** - jednoduché, ale SIM swapping risk
* **TOTP (Time-based OTP)** - Google Authenticator, Authy
* **Push notifications** - mobilní app approvals
* **Hardware tokeny** - YubiKey, RSA SecurID
* **Biometrie** - otisk prstu, Face ID

**TOTP implementace:**

* Sdílený secret mezi serverem a klientem
* 30-sekundové časové okno
* RFC 6238 standard
* QR kód pro setup

**UX considerations:**

* Remember device option
* Backup codes
* Progressive MFA (risk-based)
* Recovery mechanismy

**Výhody:**

* Významně vyšší bezpečnost
* Ochrana proti credential theft
* Compliance požadavky

**Nevýhody:**

* Složitější UX
* Device dependency
* Recovery complexity
