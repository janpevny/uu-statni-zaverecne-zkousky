# 10. Modelování datového úložiště

## Základní principy modelování

**Základní principy modelování datového úložiště**

**Hlavní cíle:**

* **Konzistence** - zajištění integrity dat
* **Efektivita** - optimalizace pro dotazy a výkon
* **Škálovatelnost** - schopnost růstu
* **Udržovatelnost** - snadná správa a evoluce

**Klíčové kroky modelování:**

1. **Analýza požadavků** - identifikace dat a operací
2. **Konceptuální model** - ER diagramy, entity a atributy
3. **Logický model** - transformace do specifického modelu (relační, dokumentový)
4. **Fyzický model** - implementace v konkrétní databázi

**Základní přístupy:**

* Normalizace (pro SQL databáze)
* Denormalizace (pro výkon)
* Schema-first vs Schema-less design

**Příklady nástrojů:** ER/Studio, MySQL Workbench, Lucidchart

## Typy relací v databázích

**Typy relací v databázích**

**1. One-to-One (1:1)**

* Jeden záznam v tabulce A odpovídá jednomu záznamu v tabulce B
* **Příklad:** Uživatel ↔ Profil
* **Implementace:** Cizí klíč s UNIQUE constraintem

**2. One-to-Many (1:N)**

* Jeden záznam v tabulce A může mít více záznamů v tabulce B
* **Příklad:** Zákazník → Objednávky
* **Implementace:** Cizí klíč v tabulce "many"

**3. Many-to-Many (M:N)**

* Více záznamů v A může odpovídat více záznamům v B
* **Příklad:** Studenti ↔ Kurzy
* **Implementace:** Spojovací tabulka (junction table)

**Referenční integrita:**

* CASCADE - automatické mazání/aktualizace
* RESTRICT - zamezení mazání
* SET NULL - nastavení na NULL

**Indexování:**

Cizí klíče by měly být indexované pro rychlejší JOIN operace

## Normalizace v SQL databázích

**Normalizace v SQL databázích**

**Cíl normalizace:**

Eliminace redundance dat a zajištění konzistence

**Normální formy:**

**1. První normální forma (1NF) - Atomické hodnoty**

*Požadavky:*
- Každá buňka obsahuje pouze atomické hodnoty
- Žádné opakující se skupiny sloupců
- Každý řádek je unikátní

*Příklad:*
```
❌ Nenormalizovaná tabulka:
Zákazník | Telefony
Jan      | 123456789, 987654321
Pavel    | 555123456

✅ 1NF:
Zákazník | Telefon
Jan      | 123456789
Jan      | 987654321
Pavel    | 555123456
```

**2. Druhá normální forma (2NF) - Eliminace parciálních závislostí**

*Požadavky:*
- Splňuje 1NF
- Všechny non-key atributy plně závislé na celém primárním klíči
- Platí pro složené primární klíče

*Příklad:*
```
❌ 1NF s parciální závislostí:
Objednávka_ID | Produkt_ID | Název_produktu | Množství
1             | 101        | Notebook       | 2
1             | 102        | Myš            | 1

✅ 2NF - rozdělení do dvou tabulek:
Objednávka_položka:                         
Objednávka_ID | Produkt_ID | Množství       
1             | 101        | 2              
1             | 102        | 1              

Produkt:
Produkt_ID | Název_produktu
101        | Notebook
102        | Myš
```

**3. Třetí normální forma (3NF) - Eliminace tranzitivních závislostí**

*Požadavky:*
- Splňuje 2NF
- Žádné tranzitivní závislosti non-key atributů
- Non-key atributy závislé pouze na primárním klíči

*Příklad:*
```
❌ 2NF s tranzitivní závislostí:
Zaměstnanec_ID | Jméno | Oddělení_ID | Název_oddělení
1              | Jan   | 10          | IT
2              | Pavel | 20          | HR

✅ 3NF - rozdělení:
Zaměstnanec:                               
Zaměstnanec_ID | Jméno | Oddělení_ID       
1              | Jan   | 10                
2              | Pavel | 20          

Oddělení:
Oddělení_ID | Název_oddělení
10          | IT
20          | HR      
```

**4. Boyce-Codd Normal Form (BCNF)**

*Požadavky:*
- Splňuje 3NF
- Každý determinant je kandidátním klíčem

**Výhody normalizace:**

* Eliminace redundance
* Konzistence dat
* Úspora místa
* Snadnější aktualizace

**Nevýhody normalizace:**

* Složitější dotazy (více JOINů)
* Pomalejší SELECT operace
* Složitější pochopení struktury

**Denormalizace:**

Záměrné porušení normálních forem pro zlepšení výkonu čtení

**Příklad:** E-shop - tabulky customers, orders, order\_items

## NoSQL přístupy k modelování

**NoSQL přístupy k modelování**

**Typy NoSQL databází:**

* **Dokumentové** - MongoDB, CouchDB
* **Key-Value** - Redis, DynamoDB
* **Sloupcové** - Cassandra, HBase
* **Grafové** - Neo4j, Amazon Neptune

**Principy NoSQL modelování:**

* **Query-driven design** - model podle dotazů
* **Denormalizace** - duplikace dat pro rychlost
* **Embedding vs Referencing** - vnořené vs odkazované dokumenty
* **Schema flexibility** - dynamické schéma

**Dokumentové databáze (MongoDB):**

* Embedded documents pro 1:N relace
* References pro M:N relace
* Collections místo tabulek

**Key-Value stores:**

* Jednoduché klíč-hodnota páry
* Žádné relace
* Rychlé čtení/zápis

**Výhody:** Škálovatelnost, flexibilita schématu, rychlost  
**Nevýhody:** Konzistence, složité dotazy, duplikace dat

## Rozdíly SQL vs NoSQL

**Rozdíly v přístupu: SQL vs NoSQL**

**SQL (Relační) přístup:**

* **Schéma:** Pevně definované, změny obtížné
* **Data model:** Tabulky s relacemi
* **Normalizace:** Vysoká, minimální redundance
* **Dotazy:** SQL, složité JOINy
* **ACID:** Plná podpora transakcí

**NoSQL přístup:**

* **Schéma:** Flexibilní nebo žádné
* **Data model:** Dokumenty, klíč-hodnota, grafy
* **Denormalizace:** Častá, duplikace pro výkon
* **Dotazy:** API specifické pro databázi
* **BASE:** Eventual consistency

**Volba podle případu použití:**

* **SQL** - finanční systémy, ERP, CRM
* **NoSQL** - big data, real-time aplikace, content management

**Hybrid přístupy:**

* NewSQL databáze
* Multi-model databáze
* Polyglot persistence

**Příklady:** PostgreSQL vs MongoDB, MySQL vs Cassandra

## Výkonnostní optimalizace

**Výkonnostní optimalizace datových úložišť**

**SQL optimalizace:**

* **Indexy** - B-tree, Hash, Bitmap indexy
* **Partitioning** - horizontální i vertikální
* **Query optimization** - EXPLAIN plans
* **Materialized views** - předpočítané výsledky

**NoSQL optimalizace:**

* **Sharding** - distribuce dat
* **Replication** - kopie pro čtení
* **Caching strategies** - in-memory cache
* **Komprese** - úspora místa

**Obecné strategie:**

* **Connection pooling** - sdílení připojení
* **Batch operations** - hromadné operace
* **Asynchronní operace** - non-blocking I/O
* **Data archivace** - stará data do cold storage

**Monitoring nástroje:**

* Query performance analyzers
* Database profilers
* Metrics dashboards

**Best practices:** Regular maintenance, statistics updates, kapacitní plánování

## Migrace a evoluce schématu

**Migrace a evoluce schématu**

**Typy změn schématu:**

* **Additive** - přidání sloupců/indexů (bezpečné)
* **Destructive** - odebrání/přejmenování (rizikové)
* **Transformative** - změna datových typů

**SQL migrace strategie:**

* **Blue-Green deployment** - paralelní prostředí
* **Rolling migrations** - postupné nasazení
* **Zero-downtime migrations** - bez výpadků
* **Backwards compatibility** - zpětná kompatibilita

**NoSQL evoluce:**

* **Schema versioning** - verzování dokumentů
* **Lazy migration** - migrace při čtení
* **Multi-version documents** - více verzí současně

**Migration nástroje:**

* **SQL:** Flyway, Liquibase, Rails migrations
* **NoSQL:** Custom scripts, ETL tools

**Best practices:**

* Testování na kopiích produkce
* Postupné rollout
* Rollback plány
* Monitoring během migrace
