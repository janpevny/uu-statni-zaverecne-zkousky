# 4. Persistence dat

## Typy a terminologie

**Typy persistence a základní terminologie**

**Typy persistence:**

* **Dočasná (Session)** - data existují pouze během běhu aplikace
* **Trvalá (Persistent)** - data přežívají restart aplikace
* **Cache** - dočasné uložení pro rychlejší přístup
* **In-memory** - data v operační paměti (Redis, Memcached)

**Základní terminologie:**

* **CRUD operace** - Create, Read, Update, Delete
* **Transakce** - skupina operací provedených jako celek
* **ACID vlastnosti** - Atomicity, Consistency, Isolation, Durability
* **CAP teorém** - Consistency, Availability, Partition tolerance (možné pouze 2 ze 3)
* **Schema** - struktura a organizace dat
* **ORM/ODM** - Object-Relational/Document Mapping

**Praktické příklady:**

* Session storage - košík v e-shopu
* Cache - uložené výsledky API volání
* Persistent - záznamy uživatelů v databázi

## ACID vs BASE principy

**ACID vs BASE principy databází**

**ACID vlastnosti (SQL databáze):**

* **Atomicity** - transakce je nedělitelná, buď proběhne celá nebo vůbec
* **Consistency** - databáze je vždy v konzistentním stavu
* **Isolation** - transakce jsou izolovány od sebe navzájem
* **Durability** - potvrzené změny jsou trvalé i při výpadku

**BASE model (NoSQL databáze):**

* **Basically Available** - systém garantuje dostupnost
* **Soft state** - stav systému se může měnit i bez vstupů
* **Eventual consistency** - systém bude konzistentní časem

**Kdy použít:**

* **ACID** - bankovnictví, e-commerce platby, ERP systémy
* **BASE** - sociální sítě, real-time aplikace, Big Data

**Kompromis:** CAP teorém - můžete mít pouze 2 ze 3: Konzistence, Dostupnost, Odolnost vůči rozdělení

## SQL databáze charakteristiky

**SQL databáze - charakteristiky a použití**

**Charakteristiky:**

* **Strukturovaná data** - pevně definované schema
* **Relační model** - tabulky propojené cizími klíči
* **SQL jazyk** - standardizovaný dotazovací jazyk
* **ACID compliance** - silné garance konzistence
* **Vertikální škálování** - výkonnější hardware

**Populární SQL databáze:**

* **MySQL/MariaDB** - open-source, populární pro web
* **PostgreSQL** - pokročilé features, JSON podpora
* **Oracle** - enterprise řešení
* **MS SQL Server** - integrace s Microsoft stack
* **SQLite** - embedded databáze, serverless

**Ideální použití:**

* E-commerce - objednávky, produkty, zákazníci
* Bankovnictví - transakce vyžadující ACID
* ERP systémy - komplexní relace mezi entitami
* CRM aplikace - strukturovaná data o zákaznících

## NoSQL databáze typy

**NoSQL databáze - typy a charakteristiky**

**Document stores:**

* **MongoDB** - BSON dokumenty, flexibilní schema
* **CouchDB** - JSON dokumenty, HTTP API
* **Firestore** - Google Cloud, real-time sync
* Vhodné pro: CMS, product catalogy, user profiles

**Key-Value stores:**

* **Redis** - in-memory, rychlý cache
* **DynamoDB** - AWS managed service
* Použití: session storage, cache, real-time data

**Column-family stores:**

* **Cassandra** - distribuovaná, vysoká dostupnost
* **HBase** - Hadoop ecosystem
* Vhodné pro: time-series data, logging, analytics

**Graph databases:**

* **Neo4j** - Cypher query language
* **Amazon Neptune** - managed graph DB
* Použití: sociální sítě, doporučovací systémy, fraud detection

## SQL vs NoSQL srovnání

**SQL vs NoSQL - kdy použít**

**Kdy použít SQL:**

* Komplexní relace mezi entitami
* ACID transakce jsou kritické
* Strukturovaná data s pevným schématem
* Komplexní dotazy s JOIN operacemi
* Reporting a analytics s agregacemi

**Kdy použít NoSQL:**

* Flexibilní schema - časté změny struktury
* Velké objemy dat - Big Data aplikace
* Vysoká rychlost - real-time aplikace
* Geografická distribuce - globální aplikace
* Jednoduché dotazy - klíč-hodnota přístup

**Hybridní přístup:**

* **Polyglot persistence** - různé databáze pro různé účely
* **SQL s JSON** - PostgreSQL, MySQL JSON columns
* **Multi-model databáze** - ArangoDB, OrientDB

**Příklad hybridní architektury:**

PostgreSQL (transakce) + Redis (cache) + Elasticsearch (search) + MongoDB (content)

## DAO pattern a Repository

**DAO pattern a Repository pattern**

**DAO (Data Access Object) koncept:**

* **Abstrakce** přístupu k datům
* **Oddělení** business logiky od persistence
* **Jednotné rozhraní** pro různé datové zdroje
* **Testovatelnost** - snadné mockování

**Struktura DAO:**

* **DAO Interface** - definuje operace (findById, save, update, delete)
* **Konkrétní implementace** - SQL DAO, MongoDB DAO, File DAO
* **Entity/Model** - datové objekty
* **Factory pattern** - vytváření správné implementace

**Repository pattern:**

* Moderní varianta DAO
* Domain-Driven Design koncept
* Agregáty místo jednotlivých entit
* Integrace s ORM frameworky

**Výhody:**

* Loose coupling mezi vrstvami
* Snadná změna datového zdroje
* Unit testing s mock objekty
* Centralizovaná logika přístupu k datům

## Databázové indexy

**Databázové indexy - typy a strategie**

**Typy indexů:**

* **Primary index** - automaticky na primary key
* **Unique index** - zajišťuje unikátnost hodnot
* **Composite index** - více sloupců dohromady
* **Full-text index** - pro textové vyhledávání
* **Spatial index** - pro geografická data

**B-Tree vs Hash indexy:**

* **B-Tree** - O(log n), vhodné pro range queries, sorting
* **Hash** - O(1) pro přesné shody, pouze equality porovnání

**Strategie indexování:**

* Indexovat sloupce v WHERE, JOIN, ORDER BY
* Composite indexy - pořadí sloupců je důležité
* Covering index - obsahuje všechny potřebné sloupce
* Index selectivity - unikátnost hodnot

**Nevýhody indexů:**

* Zpomalení INSERT/UPDATE/DELETE operací
* Dodatečné místo na disku
* Maintenance overhead
* Může zhoršit výkon při špatném návrhu

## Praktické příklady architektury

**Praktické příklady persistence architektury**

**E-shop architektura:**

* **PostgreSQL** - produkty, objednávky, platby
* **Redis** - session storage, košík
* **Elasticsearch** - full-text search
* **MongoDB** - recenze, user-generated content

**Sociální síť:**

* **Neo4j** - grafy vztahů mezi uživateli
* **Cassandra** - timeline, activity feed
* **Redis** - real-time notifications
* **PostgreSQL** - user accounts

**IoT aplikace:**

* **InfluxDB** - time-series data ze senzorů
* **Cassandra** - distribuované ukládání
* **Redis** - real-time dashboard
* **PostgreSQL** - metadata zařízení

**Mikroslužby přístup:**

* Service-specific databáze
* Event sourcing s Kafka
* CQRS pattern pro read/write
* Saga pattern pro distribuované transakce
