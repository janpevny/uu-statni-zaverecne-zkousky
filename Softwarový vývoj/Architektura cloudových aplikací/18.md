# 18. Pokročilá práce s kolekcemi

## Základní kolekce a pole

**Pole a jejich vestavěné metody**

* **Array** - základní kolekce s indexovaným přístupem
* **Mutující metody** - push(), pop(), shift(), unshift(), splice(), sort(), reverse()
* **Nemutující metody** - slice(), concat(), join(), indexOf(), includes()
* **Iterační metody** - forEach(), map(), filter(), reduce(), find(), some(), every()

**Praktické příklady:**

* **Transformace** - arr.map(x => x \* 2)
* **Filtrování** - arr.filter(x => x > 10)
* **Agregace** - arr.reduce((sum, x) => sum + x, 0)

## Kolekce ES6

**Moderní kolekce v JavaScript**

* **Set** - kolekce unikátních hodnot, rychlé vyhledávání
* **Map** - asociativní pole s libovolnými klíči
* **WeakSet** - slabé odkazy na objekty, garbage collection
* **WeakMap** - slabé odkazy klíčů, privátní vlastnosti

**Set operace:**

* **Přidání** - set.add(value)
* **Kontrola** - set.has(value)
* **Smazání** - set.delete(value)
* **Iterace** - for (let value of set)

**Map operace:**

* **Nastavení** - map.set(key, value)
* **Získání** - map.get(key)
* **Iterace** - for (let [key, value] of map)

## Objekty jako asociativní pole

**Objekty jako kolekce klíč-hodnota**

* **Object literal** - {key: value} syntaxe
* **Přístup k vlastnostem** - obj.key nebo obj['key']
* **Dynamické klíče** - obj[variable] nebo obj[expression]
* **Computed properties** - {[key]: value}

**Iterace přes objekty:**

* **Object.keys()** - pole klíčů
* **Object.values()** - pole hodnot
* **Object.entries()** - pole [klíč, hodnota] párů
* **for...in** - iterace přes enumerable vlastnosti

**Výhody Map vs Object:**

* **Map** - libovolné klíče, velikost, lepší pro častou iteraci
* **Object** - lepší performance, JSON podpora, prototyp

## Immutabilita základy

**Immutabilita v JavaScript**

* **Immutable hodnoty** - primitive typy (string, number, boolean)
* **Mutable objekty** - objekty a pole jsou defaultně mutabilní
* **Reference vs hodnota** - objekty se předávají odkazem
* **Shallow copy** - kopírování pouze prvního levelu

**Problémy s mutabilitou:**

* **Neočekávané změny** - sdílené reference
* **Debugování** - těžké sledování změn
* **Concurrency** - race conditions
* **Optimalizace** - React/Vue re-rendering

**Příklad problému:**

* **const arr = [1,2]; const arr2 = arr; arr.push(3)** - změní i arr2

## Immutabilní operace

**Vytváření immutabilních kopií**

* **Spread operator** - [...array], {...object}
* **Object.assign()** - Object.assign({}, obj)
* **Array.from()** - Array.from(original)
* **JSON metody** - JSON.parse(JSON.stringify(obj))

**Immutabilní operace s poli:**

* **Přidání** - [...arr, newItem]
* **Odebrání** - arr.filter(item => item !== target)
* **Úprava** - arr.map(item => item.id === id ? {...item, changed} : item)
* **Spojení** - [...arr1, ...arr2]

**Immutabilní operace s objekty:**

* **Úprava** - {...obj, key: newValue}
* **Odebrání** - const {removed, ...rest} = obj
* **Vnořené změny** - {...obj, nested: {...obj.nested, key: value}}

## Deep copy a reference

**Typy kopírování objektů**

* **Reference assignment** - obj2 = obj1 (sdílená reference)
* **Shallow copy** - kopírování pouze první úrovně vlastností
* **Deep copy** - rekurzivní kopírování všech úrovní
* **Structural sharing** - optimalizované immutabilní struktury

**Implementace deep copy:**

* **JSON metody** - JSON.parse(JSON.stringify()) - jednoduché ale omezené
* **Recursivní funkce** - vlastní implementace
* **Lodash cloneDeep** - knihovna s pokročilými funkcemi
* **structuredClone** - nativní API (ES2022)

**Problémy JSON metod:**

* **Funkce** - nejsou zachovány
* **undefined, Symbol** - ztraceny
* **Date objekty** - převedeny na string
* **Circular references** - chyba

## Pokročilé Array metody

**Pokročilé metody pro práci s poli**

* **flatMap()** - kombinace map() a flat()
* **flat()** - zploštění vnořených polí
* **Array.from()** - vytvoření pole z iterovatelných objektů
* **fill()** - vyplnění pole stejnou hodnotou

**Pokročilé hledání:**

* **findIndex()** - index prvního vyhovujícího prvku
* **findLast()** - poslední vyhovující prvek (ES2022)
* **findLastIndex()** - index posledního vyhovujícího prvku
* **at()** - přístup k prvku s negativním indexem

**Praktické příklady:**

* **arr.flatMap(x => [x, x\*2])** - mapování a zploštění
* **arr.flat(2)** - zploštění 2 úrovní
* **Array.from({length: 5}, (\_, i) => i)** - [0,1,2,3,4]
* **arr.at(-1)** - poslední prvek

## Performance a optimalizace

**Optimalizace práce s kolekcemi**

* **Výběr správné kolekce** - Set pro unique, Map pro key-value
* **Lazy evaluation** - generators a iterátory
* **Memoization** - cache výsledků funkcí
* **Object pooling** - znovupoužití objektů

**Performance tips:**

* **Set.has()** - O(1) vs Array.includes() - O(n)
* **Map.get()** - rychlejší než object property lookup
* **for...of vs forEach** - for...of je rychlejší
* **Sparse arrays** - pozor na holes v polích

**Immutabilní knihovny:**

* **Immutable.js** - Facebook knihovna
* **Immer** - produce() s draft objekty
* **Lodash/fp** - funkcionální utility
* **Ramda** - funkcionální programování
