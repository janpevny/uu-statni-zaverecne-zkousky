# 19. Výjimky a zpracování chyb

## Úvod do výjimek

**Výjimky (Exceptions)**

**Definice:**

Mechanismus pro zpracování chybových stavů a neočekávaných situací během běhu programu

**Charakteristiky:**

* **Runtime chyby** - nastávají během běhu programu
* **Objekty** - výjimky jsou objekty obsahující informace o chybě
* **Šíření** - propagují se call stackem směrem nahoru
* **Přerušení** - mění běžný tok programu

**Typy chyb:**

* Syntaktické chyby (compile-time)
* Logické chyby (runtime)
* Runtime exceptions (runtime)

**Výhody:**

* Oddělení error handlingu od hlavní logiky
* Centralizované zpracování chyb
* Čitelnější kód
* Informativní error messages

**Příklady výjimek:** NullPointerException, IOException, ArithmeticException

## Try-catch blok

**Try-catch blok**

**Syntaxe:**

try { // rizikovní kód } catch (ExceptionType e) { // zpracování chyby }

**Komponenty:**

* **try blok** - obsahuje kód, který může vyhodit výjimku
* **catch blok** - zpracovává specifický typ výjimky
* **Exception parameter** - objekt s informacemi o chybě

**Více catch bloků:**

* Možnost zachytit různé typy výjimek
* Pořadí od nejspecifičtější po nejobecnější
* Pouze jeden catch blok se spustí

**Výhody:**

* Kontrolované zpracování chyb
* Program nekrachuje při chybě
* Možnost recovery akce
* Logging chybových stavů

**Best practices:**

* Zachytávej pouze výjimky, které umíš zpracovat
* Nepoužívaj prázdné catch bloky
* Loguj chyby pro debugging

## Finally blok

**Finally blok**

**Charakteristiky:**

* **Vždy se spustí** - bez ohledu na to, zda nastala výjimka
* **Cleanup operace** - uzavření resources, souborů, spojení
* **Spuštění** - i při return statement v try/catch

**Syntaxe:**

try { // kód } catch (Exception e) { // zpracování } finally { // cleanup }

**Typické použití:**

* Uzavření souborů a streamů
* Uvolnění databázových spojení
* Uzavření síťových spojení
* Uvolnění paměti

**Výhody:**

* Garantované vykonání cleanup kódu
* Prevence resource leaks
* Jednodušší resource management

**Nevýhody:**

* Může maskovat výjimky z try/catch
* Složitější debugging pokud finally vyhodí výjimku

**Poznámka:** Try-with-resources v Javě je modernější alternativa pro resource management

## Typy výjimek

**Typy výjimek**

**Checked Exceptions:**

* **Definice** - musí být explicitně zpracovány nebo deklarovány
* **Compile-time kontrola** - kompilátor vyžaduje handling
* **Příklady** - IOException, SQLException, ClassNotFoundException

**Unchecked Exceptions (Runtime):**

* **Definice** - nemusí být explicitně zpracovány
* **Runtime kontrola** - nastávají během běhu programu
* **Příklady** - NullPointerException, IndexOutOfBoundsException, IllegalArgumentException

**Errors:**

* **Systémové chyby** - OutOfMemoryError, StackOverflowError
* **Nejsou určené** - k zachycení aplikačním kódem
* **JVM problémy** - obvykle znamenají serious issues

**Hierarchie (Java):**

Throwable → Exception/Error → RuntimeException/CheckedException

**Best practices:**

* Používej checked exceptions pro recoverable conditions
* Runtime exceptions pro programming errors

## Throw a throws

**Throw a throws klíčová slova**

**Throw:**

* **Vyhazování výjimky** - explicitní vyvolání exception
* **Syntaxe** - throw new ExceptionType(\"message\")
* **Použití** - v aplikační logice pro error conditions

**Throws:**

* **Deklarace výjimek** - v method signature
* **Syntaxe** - public void method() throws IOException
* **Kontakt** - informuje caller o možných výjimkách

**Příklad:**

public void readFile() throws IOException {  
  if (file == null) {  
    throw new IllegalArgumentException(\"File cannot be null\");  
  }  
}

**Re-throwing:**

* Zachycení a znovu vyhození výjimky
* Možnost logování před re-throw
* Wrapping do jiného typu výjimky

**Best practices:**

* Používej specifické exception types
* Informativní error messages
* Nepoužívej exceptions pro control flow

## Custom výjimky

**Vlastní (Custom) výjimky**

**Definice:**

Uživatelem definované třídy výjimek pro specifické business logic chyby

**Vytvoření:**

* **Dědění** - od Exception nebo RuntimeException
* **Konstruktory** - parametrické pro message a cause
* **Naming** - končí slovem Exception

**Příklad (Java):**

public class UserNotFoundException extends Exception {  
  public UserNotFoundException(String message) {  
    super(message);  
  }  
}

**Výhody:**

* Expresivní error handling
* Business logic specifické chyby
* Snadnější debugging
* Čistší API design

**Kdy vytvořit:**

* Specifické business rule violations
* Domain-specific error conditions
* Když standard exceptions nejsou dostatečně expresivní

**Best practices:**

* Logický naming
* Dokumentace použití
* Minimal hierarchy
* Reusable design

## Error handling strategie

**Strategie zpracování chyb**

**Fail-fast:**

* **Rychlé detekce** - chyby se odhalí co nejdříve
* **Input validation** - kontrola parametrů na začátku
* **Výhoda** - snadnější debugging, prevence corrupted state

**Graceful degradation:**

* **Pokračování v běhu** - aplikace funguje i při chybách
* **Fallback mechanismy** - náhradní řešení
* **Použití** - kritické systémy, user-facing aplikace

**Centralized error handling:**

* **Global exception handlers** - centrální místo pro zpracování
* **Logging a monitoring** - unified approach
* **Příklady** - @ControllerAdvice v Spring, Global.asax v .NET

**Circuit breaker pattern:**

* **Ochrана před cascading failures**
* **Monitoring external services**
* **Temporary failure handling**

**Best practices:**

* Konzistentní error handling
* Meaningful error messages
* Appropriate logging levels
* User-friendly error presentation

## Debugging a monitoring

**Debugging a monitoring výjimek**

**Stack trace:**

* **Call stack informace** - kde nastala chyba
* **Method chain** - sekvence volání
* **Line numbers** - přesné umístění v kódu
* **Nested exceptions** - cause chain

**Logging:**

* **Error levels** - DEBUG, INFO, WARN, ERROR, FATAL
* **Structured logging** - konzistentní formát
* **Context information** - user ID, request ID, timestamp

**Monitoring nástroje:**

* **APM** - New Relic, Datadog, AppDynamics
* **Error tracking** - Sentry, Rollbar, Bugsnag
* **Log aggregation** - ELK Stack, Splunk

**Metriky:**

* Error rates
* Response times
* Exception frequencies
* Business impact metrics

**Best practices:**

* Meaningful error messages
* Correlation IDs pro request tracking
* Alerting na kritické chyby
* Regular error analysis
* Post-mortem analysis
