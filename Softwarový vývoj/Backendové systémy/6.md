# 6. Relační databáze

## Základní vlastnosti relačních databází

**Relační databáze - základní vlastnosti**

**Definice:**

Databázový model založený na relačním modelu dat, kde jsou data organizována do tabulek (relací) s řádky (tuples) a sloupci (attributy)

**Klíčové vlastnosti:**

* **Strukturovaná data** - data v tabulkách s pevnou strukturou
* **Relace mezi tabulkami** - propojení pomocí cizích klíčů
* **ACID vlastnosti** - Atomicity, Consistency, Isolation, Durability
* **Normalizace** - eliminace redundance dat

**Základní komponenty:**

* **Tabulky (Relations)** - základní datová struktura
* **Řádky (Tuples)** - jednotlivé záznamy
* **Sloupce (Attributes)** - datová pole
* **Primární klíč** - unikátní identifikátor řádku
* **Cizí klíč** - odkaz na jiný záznam

**Příklady systémů:** MySQL, PostgreSQL, Oracle, SQL Server, SQLite

## Výhody a nevýhody relačních databází

**Výhody a nevýhody relačních databází**

**Výhody:**

* **ACID compliance** - garantuje datovou konzistenci
* **Standardizované dotazy** - SQL jako univerzální jazyk
* **Normalizace** - eliminuje duplikaci dat
* **Referenční integrita** - zajišťuje konzistenci vztahů
* **Zralá technologie** - dlouhá historie, stabilita
* **Nástroje a podpora** - široká nabídka nástrojů

**Nevýhody:**

* **Vertikální škálování** - obtížná horizontální distribuce
* **Rigid schéma** - změny struktury jsou náročné
* **Performance limity** - u velkých objemů dat
* **Object-Relational impedance mismatch** - rozdíly s OOP
* **Složitost JOINů** - výkonnostní problémy u komplexních dotazů
* **Licenční náklady** - u komerčních databází

**Alternativy:**

NoSQL databáze (MongoDB, Cassandra), Graph databáze (Neo4j), Time-series databáze

## SQL jazyk a jeho kategorie

**SQL (Structured Query Language)**

**Definice:**

Standardizovaný deklarativní jazyk pro práci s relačními databázemi

**Kategorie SQL příkazů:**

1. **DDL (Data Definition Language)** - definice struktury
   * CREATE, ALTER, DROP, TRUNCATE
2. **DML (Data Manipulation Language)** - manipulace s daty
   * SELECT, INSERT, UPDATE, DELETE
3. **DCL (Data Control Language)** - řízení přístupu
   * GRANT, REVOKE
4. **TCL (Transaction Control Language)** - řízení transakcí
   * COMMIT, ROLLBACK, SAVEPOINT

**Základní operace:**

* **JOIN** - spojování tabulek (INNER, LEFT, RIGHT, FULL)
* **WHERE** - filtrování dat
* **GROUP BY** - seskupování dat
* **ORDER BY** - řazení výsledků
* **Agregační funkce** - COUNT, SUM, AVG, MIN, MAX

**Pokročilé funkce:** Subqueries, Views, Stored Procedures, Triggers, Indexy

## SQL dotazy a optimalizace

**SQL dotazy a optimalizace výkonu**

**Typy dotazů:**

* **Jednoduché SELECT** - základní výběr dat
* **JOIN dotazy** - spojování více tabulek
* **Subqueries** - vnořené dotazy
* **Agregační dotazy** - seskupování a statistiky

**Optimalizace výkonu:**

* **Indexy** - B-tree, Hash, Bitmap indexy
* **Query plánování** - EXPLAIN plán vykonání
* **Statistiky tabulek** - pro optimalizátor
* **Partitioning** - rozdělení velkých tabulek

**Best practices:**

* Používat WHERE klauzule pro filtrování
* Vyhýbat se SELECT \*
* Optimalizovat JOIN podmínky
* Používat LIMIT pro omezení výsledků
* Analyzovat execution plány

**Nástroje:** Query analyzéry, Database profilers, Performance monitors

## Transakce a ACID vlastnosti

**Databázové transakce a ACID**

**Definice transakce:**

Logická jednotka práce skládající se z jedné nebo více databázových operací, která se provádí atomicky

**ACID vlastnosti:**

* **Atomicity (Atomičnost)** - všechny operace nebo žádná
* **Consistency (Konzistence)** - databáze zůstává v konzistentním stavu
* **Isolation (Izolace)** - transakce neovlivňují jedna druhou
* **Durability (Trvanlivost)** - potvrzené změny jsou trvalé

**Úrovně izolace:**

1. **READ uncommitted** - nejnižší, možné dirty reads
2. **read committed** - čte jen potvrzené změny
3. **repeatable read** - konzistentní čtení během transakce
4. **serializable** - nejvyšší, úplná izolace

**Problémy bez správné izolace:**

* Dirty Read, Non-repeatable Read, Phantom Read

**Řízení transakcí:** BEGIN, COMMIT, ROLLBACK, SAVEPOINT

## Normální formy databází

**Normální formy (Normal Forms)**

**Účel normalizace:**

Proces organizace dat v databázi pro minimalizaci redundance a závislostí

**První normální forma (1NF):**

* Atomické hodnoty v každém sloupci
* Žádné opakující se skupiny
* Každý řádek unikátní

**Druhá normální forma (2NF):**

* Splňuje 1NF
* Všechny non-key atributy plně závislé na primárním klíči
* Eliminuje parciální závislosti

**Třetí normální forma (3NF):**

* Splňuje 2NF
* Žádné tranzitivní závislosti non-key atributů
* Non-key atributy nezávislé na jiných non-key atributech

**Vyšší normální formy:**

BCNF, 4NF, 5NF - pro pokročilejší případy

**Trade-off:**

Vyšší normalizace → méně redundance, ale více JOINů a možná horší performance

## Indexy a optimalizace výkonu

**Databázové indexy a výkonnostní optimalizace**

**Typy indexů:**

* **B-tree index** - nejběžnější, pro range queries
* **Hash index** - pro equality lookups
* **Bitmap index** - pro low-cardinality data
* **Compound index** - více sloupců současně

**Výhody indexů:**

* Rychlejší SELECT operace
* Rychlejší JOIN operace
* Rychlejší ORDER BY a GROUP BY
* Unikátní omezení

**Nevýhody indexů:**

* Dodatečné místo na disku
* Pomalejší INSERT, UPDATE, DELETE
* Údržba indexů

**Optimalizační techniky:**

* **Query optimization** - analyze execution plans
* **Table partitioning** - rozdělení velkých tabulek
* **Materialized views** - pre-computed results
* **Connection pooling** - efektivní správa připojení

**Monitoring:** Slow query logs, Performance metrics, Index usage statistics

## Databázový design a modelování

**Databázový design a datové modelování**

**Fáze návrhu:**

1. **Konceptuální model** - ER diagram, high-level view
2. **Logický model** - normalizace, tabulky a vztahy
3. **Fyzický model** - implementace, indexy, storage

**ER diagramy:**

* **Entity** - objekty reálného světa
* **Atributy** - vlastnosti entit
* **Relationships** - vazby mezi entitami
* **Kardinalita** - 1:1, 1:N, M:N vztahy

**Best practices:**

* Jasná jmenná konvence
* Správné datové typy
* Referenční integrita (foreign keys)
* Indexy pro často dotazované sloupce
* Dokumentace schématu

**Anti-patterns:**

* EAV (Entity-Attribute-Value) model
* Polymorphic associations
* Magic numbers místo lookup tables

**Nástroje:** ERD tools, Database design software, Schema migration tools
