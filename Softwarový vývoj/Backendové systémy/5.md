# 5. Vybrané architektonické koncepty backendů

## Autentizace

**Autentizace (Authentication)**

**Definice:**

Proces ověření identity uživatele - "kdo jste?"

**Základní metody:**

* **Session-based** - server si udržuje session store
* **Token-based** - JWT, API keys
* **OAuth/OpenID Connect** - delegovaná autentizace
* **Multi-factor (MFA)** - kombinace více faktorů

**Výhody JWT:**

* Stateless - neukládá se na serveru
* Škálovatelnost
* Cross-domain fungování
* Obsahuje payload s claims

**Nevýhody JWT:**

* Velikost tokenu
* Nelze jednoduše revoknout
* Složitější refresh mechanismus

**Implementace:** Spring Security, Passport.js, Auth0, Firebase Auth

## Autorizace

**Autorizace (Authorization)**

**Definice:**

Proces kontroly oprávnění - "co smíte dělat?"

**Modely přístupových práv:**

* **RBAC** (Role-Based Access Control) - založené na rolích
* **ABAC** (Attribute-Based Access Control) - založené na atributech
* **ACL** (Access Control Lists) - seznamy oprávnění
* **PBAC** (Policy-Based Access Control) - založené na policies

**Implementace v kódu:**

* Middleware/Interceptory
* Dekorátory/Anotace (@PreAuthorize)
* Guards v routách
* Policy engines

**Výhody RBAC:**

* Jednoduchost implementace
* Snadná správa
* Přehlednost

**Nevýhody RBAC:**

* Rigidnost
* Exploze rolí
* Složitost u komplexních scénářů

**Nástroje:** Spring Security, Casbin, Open Policy Agent (OPA)

## Error Handling

**Error Handling**

**Typy chyb:**

* **Client errors (4xx)** - chyby na straně klienta
* **Server errors (5xx)** - chyby na straně serveru
* **Business logic errors** - porušení obchodních pravidel
* **System errors** - databáze, síť, externí služby

**Strategie zpracování:**

* **Exception handling** - try-catch bloky
* **Global error handlers** - centralizované zpracování
* **Circuit breaker pattern** - ochrana před kaskádovými chybami
* **Retry mechanisms** - opakování neúspěšných operací

**Best practices:**

* Nezobrazovat stacktrace klientovi
* Vracet konzistentní error objekty
* Logování všech chyb
* Graceful degradation

**Návrhové vzory:**

* Result pattern
* Exception translation
* Error codes vs exceptions

**Nástroje:** Sentry, Bugsnag, Rollbar, Elastic APM

## Validace

**Validace dat**

**Úrovně validace:**

1. **Client-side** - rychlá zpětná vazba uživateli
2. **Server-side** - bezpečnostní validace (nutná!)
3. **Database level** - constraints, triggers

**Typy validace:**

* **Syntaktická** - formát dat (email, telefon)
* **Sémantická** - význam dat (věk > 0)
* **Business rules** - obchodní pravidla
* **Cross-field** - vztahy mezi poli

**Implementační přístupy:**

* **Schema validation** - JSON Schema, Joi
* **Annotation-based** - Bean Validation (JSR 380)
* **Fluent validation** - programatické API
* **Custom validators** - specifická pravidla

**Best practices:**

* Fail fast - včasné odhalení chyb
* Clear error messages
* Sanitizace vstupů
* Validace na hranicích systému

**Nástroje:** Joi, Yup, class-validator, Bean Validation, Express Validator

## Logování základy

**Logování - základy**

**Log levels:**

1. **TRACE** - nejdetailnější informace
2. **DEBUG** - debugging informace
3. **INFO** - obecné informační zprávy
4. **WARN** - varování, neočekávané situace
5. **ERROR** - chyby, které nezastavují aplikaci
6. **FATAL** - kritické chyby vedoucí k ukončení

**Co logovat:**

* Začátek a konec operací
* Chyby a výjimky
* Bezpečnostní události
* Performance metriky
* User actions (audit trail)

**Co NElogovat:**

* Hesla a sensitive data
* Personal identifiable information (PII)
* Tokeny a API keys
* Credit card numbers

**Formát logů:**

* **Structured logging** - JSON formát
* **Correlation IDs** - sledování requestů
* **Timestamps** - ISO 8601 formát
* **Context information** - user ID, session

**Nástroje:** Logback, Winston, Serilog, Log4j

## Logování pokročilé

**Logování - pokročilé koncepty**

**Centralizované logování:**

* **Log aggregation** - shromažďování z více zdrojů
* **ELK Stack** - Elasticsearch, Logstash, Kibana
* **Fluentd/Fluent Bit** - log shipping
* **Grafana Loki** - log agregace pro Prometheus

**Structured logging:**

* JSON format pro lepší parsování
* Konzistentní schéma
* Metadata a kontextové informace
* Query-friendly formát

**Performance considerations:**

* **Asynchronous logging** - neblokující operace
* **Log rotation** - správa velikosti souborů
* **Sampling** - logování jen vzorku dat
* **Buffering** - batch zpracování

**Monitoring a alerting:**

* Error rate monitoring
* Log-based metrics
* Anomaly detection
* Real-time alerting

**Compliance:**

* GDPR - anonymizace PII
* Retention policies
* Audit requirements

**Nástroje:** ELK Stack, Splunk, Datadog, New Relic

## Bezpečnostní aspekty

**Bezpečnostní aspekty backendů**

**Input Security:**

* **SQL Injection** - prepared statements, ORM
* **XSS** - input sanitization, output encoding
* **CSRF** - tokens, SameSite cookies
* **Path traversal** - validace cest k souborům

**API Security:**

* **Rate limiting** - ochrana před abuse
* **API versioning** - zpětná kompatibilita
* **CORS** - cross-origin kontrola
* **Content-Type validation**

**Data Protection:**

* **Encryption at rest** - databáze, file systém
* **Encryption in transit** - HTTPS, TLS
* **Key management** - rotace, storage
* **Hashing passwords** - bcrypt, scrypt

**Security Headers:**

* Content-Security-Policy
* X-Frame-Options
* X-Content-Type-Options
* Strict-Transport-Security

**Monitoring:**

* Security logging
* Intrusion detection
* Vulnerability scanning

**Nástroje:** OWASP ZAP, Snyk, SonarQube, Helmet.js

## Performance a optimalizace

**Performance a optimalizace**

**Caching strategie:**

* **In-memory cache** - Redis, Memcached
* **Database query cache** - výsledky dotazů
* **Application-level cache** - objekty, výpočty
* **CDN** - statické assety

**Database optimalizace:**

* **Indexy** - rychlejší vyhledávání
* **Query optimization** - EXPLAIN plans
* **Connection pooling** - efektivní správa spojení
* **Read replicas** - škálování čtení

**API optimalizace:**

* **Pagination** - omezení velikosti odpovědí
* **Field selection** - GraphQL, sparse fieldsets
* **Compression** - gzip, brotli
* **HTTP caching** - ETag, Cache-Control

**Asynchronní zpracování:**

* **Message queues** - RabbitMQ, AWS SQS
* **Event-driven architecture**
* **Background jobs** - Celery, Bull

**Monitoring:**

* Response time metrics
* Throughput monitoring
* Resource utilization
* APM tools

**Nástroje:** Redis, New Relic, Prometheus, Grafana
